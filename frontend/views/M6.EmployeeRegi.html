<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="UTF-8">
    <title>Manager Dashboard - Employee Registration</title>
    <link rel="stylesheet" href="../styles/style.css">
    <link rel="stylesheet" href="../styles/M0.Style.css">
    <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet'>
    
    <style>
      body { padding-top: 5rem; }
      .form-wrapper { max-width: 400px; margin: 2rem auto; padding: 1.5rem; background: #fff; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
      input, select, button { width: 100%; padding: 0.5rem; margin: 0.5rem 0; font-size: 1rem; }
      #response { text-align: center; margin-top: 1rem; }
      table { width: 100%; margin-top: 2rem; border-collapse: collapse; }
      th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: center; }
      .top-row { margin-bottom: 1rem; }
    </style>

  </head>

  <body>

    <div class="top-row">
      <div class="tab"><a href="M1.TableView.html"><h2>Table View</h2></a></div>
      <div class="tab"><a href="M2.Orders.html"><h2>Orders</h2></a></div>
      <div class="tab"><a href="M3.OrderHistory.html"><h2>Order History</h2></a></div>
      <div class="tab"><a href="M4.Inventory.html"><h2>Inventory</h2></a></div>
      <div class="tab"><a href="M5.Analytics.html"><h2>Analytics</h2></a></div>
      <div class="selectedTab"><h2>Employee Regi.</h2></div>
      <div class="tab"><a href="M7.ClockInHistory.html"><h2>Clock-In History</h2></a></div>
    </div>

    <div class="form-wrapper">
      <h2>Register or Update Employee</h2>
      <input type="text" id="username" placeholder="Username" required>
      <input type="password" id="password" placeholder="Password" required>
      <input type="text" id="employee_id" placeholder="Employee ID" required>
      <select id="role">
        <option value="Waiter">Waiter</option>
        <option value="Chef">Chef</option>
        <option value="Busboy">Busboy</option>
        <option value="Manager">Manager</option>
      </select>
      <button onclick="registerEmployee()">Register</button>
      <button onclick="updateEmployee()">Update</button>
      <p id="response"></p>
    </div>

    <div class="form-wrapper">
      <h2>Current Employees</h2>
      <table>
        <thead>
          <tr><th>Username</th><th>Role</th><th>Employee ID</th><th>Action</th></tr>
        </thead>
        <tbody id="employee-list"></tbody>
      </table>
    </div>

    <script>
      async function registerEmployee() {
        const data = getFormData();
        const res = await fetch("http://localhost:5000/api/manager/employees", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const msg = await res.json();
        document.getElementById("response").textContent = msg.message || "Employee registered.";
        fetchEmployees();
      }

      async function updateEmployee() {
        const data = getFormData();
        const res = await fetch("http://localhost:5000/api/manager/employees/update", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const msg = await res.json();
        document.getElementById("response").textContent = msg.message || "Employee updated.";
        fetchEmployees();
      }

      async function deleteEmployee(username) {
        const res = await fetch("http://localhost:5000/api/manager/employees/delete", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ UserName: username })
        });
        const msg = await res.json();
        document.getElementById("response").textContent = msg.message || "Employee removed.";
        fetchEmployees();
      }

      function getFormData() {
        return {
          UserName: document.getElementById("username").value,
          Password: document.getElementById("password").value,
          EmployeeID: document.getElementById("employee_id").value,
          Role: document.getElementById("role").value
        };
      }

      async function fetchEmployees() {
        const res = await fetch("http://localhost:5000/api/manager/employees");
        const data = await res.json();
        const tbody = document.getElementById("employee-list");
        tbody.innerHTML = "";
        data.forEach(emp => {
          const row = `<tr>
            <td>${emp.UserName}</td>
            <td>${emp.Role}</td>
            <td>${emp.EmployeeID}</td>
            <td><button onclick=\"deleteEmployee('${emp.UserName}')\">Delete</button></td>
          </tr>`;
          tbody.innerHTML += row;
        });
      }

      window.onload = fetchEmployees;
      
    </script>

  </body>

</html>